<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Player</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://content.jwplatform.com/libraries/SAHhwvZq.js"></script>
    <style>
        #jwplayerDiv {
            width: 100%;
            max-width: 800px; /* Optional: Set maximum width */
            margin: 0;
        }
    </style>
</head>

<body>
    <div id="jwplayerDiv"></div>

    <script>
        // Function to fetch JSON data
        function fetchChannels(callback) {
            var url = 'https://universe-cors.deno.dev/https://universe-channels.deno.dev';
            fetch(url)
                .then(response => response.json())
                .then(data => callback(data))
                .catch(error => console.error('Error fetching JSON:', error));
        }

        var mpdfile = channelData.data.channels[0].manifest_url
        var title = channelData.data.channels[0].name
        // Define player setup function
        function setupPlayer(channelData) {
            // Set up JWPlayer
            var playerSetup = {
                file: 'mpdfile', // Use the manifest_url from your JSON
                position: 'bottom',
                autostart: true,
                stretching: "",
                width: "100%",
                title: 'title' // Set title from channel data
            };

            // Check if the manifest type is MPEG-DASH
            if (channelData.data.channels[0].manifest_type === 'MPEG-DASH|DASH|MPD') {
                // Set up DRM for DASH with keys if available
                playerSetup.type = 'dash';

                // Check if Clear Key is available
                if (channelData.data.channels[0].clearkeys) {
                    playerSetup.drm = {
                        clearkey: {
                            url: channelData.data.channels[0].license_url,
                            headers: channelData.data.channels[0].manifest_headers,
                            key: channelData.data.channels[0].clearkeys.key
                        }
                    };
                } else {
                    console.error('Clear keys not available.');
                }
            } else {
                // Default to HLS without keys
                playerSetup.type = 'hls';
            }

            jwplayer("jwplayerDiv").setup(playerSetup);
        }

        // Fetch channels data and set up the player
        fetchChannels(function(response) {
            // Set up the player with the channel data
            setupPlayer(response);
        });

        // Adjust player size on window resize
        window.addEventListener('resize', function() {
            var playerDiv = document.getElementById('jwplayerDiv');
            var playerWidth = playerDiv.offsetWidth; // Get the width of the player div
            var playerHeight = playerWidth * 0.5625; // Calculate height to maintain 16:9 aspect ratio
            jwplayer().resize(playerWidth, playerHeight); // Resize the player
        });
    </script>

    <!-- Cloudflare Web Analytics -->
    <script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "69cc198caeb54890bfc3f54a55843365"}'>
    </script>

    <!-- End Cloudflare Web Analytics -->
</body>

</html>
